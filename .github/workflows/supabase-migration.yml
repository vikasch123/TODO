name: Supabase Migration

on:
  push:
    branches: [ main, master ]
    paths:
      - 'supabase/migrations/**'

jobs:
  apply-migrations:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4  # Updated to latest version
      
    - name: Setup Supabase CLI
      uses: supabase/setup-cli@v1
      with:
        version: latest
        
    - name: Apply migrations to Supabase
      run: |
        echo "ðŸ”— Linking to Supabase Project..."
        supabase link --project-ref ${{ secrets.SUPABASE_PROJECT_ID }} --token ${{ secrets.SUPABASE_ACCESS_TOKEN }}
        
        echo "ðŸš€ Applying database migrations..."
        supabase db push
      env:
        SUPABASE_ACCESS_TOKEN: ${{ secrets.SUPABASE_ACCESS_TOKEN }}
